# how it works
for those who are inclined to know how to develop one themselves

## step 1: authenticate accounts
when making requests to edit the canvas, an `authorization` header is required for every `POST`. the only viable way to obtain a valid authorization token is from a [reddit developer app](https://www.reddit.com/prefs/apps). if an account is a developer of the app, it can make a `POST` request to the [reddit api and obtain a temporary access token that lasts 1 hour](https://github.com/michaelshumshum/r-placer/blob/df10c4bd8c5b9663321429d2f09f27e7185e0b32/bot.py#L87-L101). in my bot, all developer accounts are listed. if an account is not a developer yet, [it will be added via another post request](https://github.com/michaelshumshum/r-placer/blob/df10c4bd8c5b9663321429d2f09f27e7185e0b32/bot.py#L43-L75). this was the only tacky thing we need to do. all other parts of the request only involve [specifying our parameters in a certain format](https://github.com/michaelshumshum/r-placer/blob/df10c4bd8c5b9663321429d2f09f27e7185e0b32/bot.py#L12-L40).

## step 2: determine what pixels to change on the canvas
first, we need to convert our image into data that describes what color. the original image is in rgb, but our r/place is limited to a 31-color-pallete, each color with an index number. this can be determined by [calculating the distance of rgb values between the original image and the color pallete and returning the best color index](https://github.com/michaelshumshum/r-placer/blob/df10c4bd8c5b9663321429d2f09f27e7185e0b32/parse_image.py#L32-L41). (note: hex color is actually the same as rgb. every two digits of hex is just the hex form of rgb values, so the distance calculation is straight forward using the 3-dimensional distance formula.) with that handy, all we need to do is [iterate over the entire image](https://github.com/michaelshumshum/r-placer/blob/df10c4bd8c5b9663321429d2f09f27e7185e0b32/parse_image.py#L48-L59).

next, we need to compare the pixels already on the canvas to our image's pixels. we can get the [board image quite easily thanks to dsf3499 and his endpoint](https://github.com/michaelshumshum/r-placer/blob/df10c4bd8c5b9663321429d2f09f27e7185e0b32/parse_image.py#L48-L59). we can also run the same image parsing function we used on our own imge on the board. with two arrays of pixels, we just have to determine what pixels do not match up and send it to our workers. (note: this comparison is useful for efficiency and for maintiaining artwork after the image is drawn.)

## step 3: manage our bot accounts
considering that each account has a cooldown, it is definitely in our interest to have multiple accounts to increase speed and efficiency in maintaining artwork. [coordinating the bots requires an event queue that can be sent to workers individually](https://github.com/michaelshumshum/r-placer/blob/df10c4bd8c5b9663321429d2f09f27e7185e0b32/management.py#L127-L140). (note: worker threads are not bound to any single account. each worker is can randomly choose an available account and use it. this is reduce the amount of improve performance as we won't have many useless, hanging threads.) the event queue is update in intervals to allow time for lag and decrease workload. you can picture the event queuer as a queen bee and the worker threads as worker bees.

we will also need to determine what accounts are available for use. some may have been banned by the system, some might be in use by another worker, while some could just be in their cooldown. whenever we make a change to the canvas, we are returned a json that describes the state of the account, most importantly, how much longer until we can draw again. this alone can tell us if we are banned or if we just in a cooldown. if the time is extremely long (speficially 15 years), we are most definitely banned. otherwise, the account is just unavailable. knowing this makes sure that the next events will not use this account at least for some time.
